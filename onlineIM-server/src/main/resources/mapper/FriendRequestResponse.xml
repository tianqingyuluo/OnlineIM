<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="icu.tianqingyuluo.onlineim.mapper.FriendRequestResponseMapper">
    <!-- 用户结果映射 -->
    <resultMap id="FriendRequestResponseMap" type="icu.tianqingyuluo.onlineim.pojo.dto.response.FriendRequestResponse">
        <id property="requestID" column="id"/>
        <result property="message" column="req_message"/>
        <result property="status" column="req_status"/>
        <result property="createdAt" column="created_at"/>
        <association property="senderInfo" javaType="icu.tianqingyuluo.onlineim.pojo.dto.response.UserBriefResponse">
            <id property="userId" column="id"/>
            <result property="username" column="username"/>
            <result property="nickname" column="nickname"/>
            <result property="avatarUrl" column="avatar"/>
        </association>
    </resultMap>
    <select id="getFriendRequestListByUserID" resultMap="FriendRequestResponseMap">
        SELECT
            fr.id,
            fr.message as req_message,
            fr.status as req_status,
            fr.created_at,
            u.id,
            u.username,
            u.nickname,
            u.avatar
        FROM
            friend_requests fr
            INNER JOIN
            users u ON fr.to_user_id = u.id
        WHERE
            fr.to_user_id = #{id}
        ORDER BY fr.updated_at DESC
    </select>
    <select id="getSendFriendRequestListByUserID" resultMap="FriendRequestResponseMap">
        SELECT
            fr.id,
            fr.message as req_message,
            fr.status as req_status,
            fr.created_at,
            u.id,
            u.username,
            u.nickname,
            u.avatar
        FROM
            friend_requests fr
        INNER JOIN
            users u ON fr.to_user_id = u.id
        WHERE
            fr.from_user_id = #{id}
        ORDER BY fr.updated_at DESC
    </select>
    <select id="existFriendByID" >
        SELECT EXISTS(
            SELECT 1
            FROM user_friends
            WHERE
                user_id = #{friendId}        -- 替换为目标用户ID
              AND friend_id = #{userid}      -- 替换为要验证的好友ID
        ) AS is_friend;
    </select>
</mapper>